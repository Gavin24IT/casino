<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gavinâ€™s High Stakes Casino</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* ========== CSS Variables (Theming) ========== */
    :root {
      --primary-bg: #1A1A2E;
      --secondary-bg: #16213E;
      --header-bg: #0F3460;
      --accent-color: #E94560;
      --text-color: #E0E0E0;
      --button-primary: #007bff;
      --button-mines: #28a745;
      --button-baccarat: #17a2b8;
      --button-warning: #ffc107;
      --card-back-color: #333;
      --card-front-color: #f7f7f7;
      --red-suit-color: #E74C3C;
      --shadow-dark: rgba(0,0,0,0.4);
      --shadow-light: rgba(0,0,0,0.2);
    }

    /* ========== Global Reset & Base Styles ========== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      font-family: 'Roboto', sans-serif;
      overflow-x: hidden;
      background: linear-gradient(135deg, var(--primary-bg), var(--secondary-bg));
      color: var(--text-color);
      position: relative;
      font-size: 16px;
      line-height: 1.6;
    }

    /* ========== Header ========== */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 70px;
      background: var(--header-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 5%;
      z-index: 1000;
      box-shadow: 0 4px 10px var(--shadow-dark);
    }
    header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
      letter-spacing: 2px;
      color: var(--accent-color);
      text-shadow: 0 0 10px rgba(233, 69, 96, 0.6);
      animation: neonPulse 2s ease-in-out infinite alternate;
    }
    @keyframes neonPulse {
      0% { transform: scale(1); text-shadow: 0 0 5px rgba(233, 69, 96, 0.6), 0 0 10px rgba(233, 69, 96, 0.4); }
      100% { transform: scale(1.03); text-shadow: 0 0 8px rgba(233, 69, 96, 0.8), 0 0 15px rgba(233, 69, 96, 0.6); }
    }
    .balance {
      font-size: 1.2rem;
      font-weight: bold;
      color: #FFF;
      background: rgba(0,0,0,0.3);
      padding: 8px 15px;
      border-radius: 5px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    }

    /* ========== Fullscreen Screens (Solid Background) ========== */
    .screen {
      position: absolute;
      top: 70px;
      left: 0;
      width: 100%;
      min-height: calc(100% - 70px);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px 20px;
      overflow-y: auto;
      background: var(--secondary-bg);
      z-index: 500;
      animation: fadeIn 0.6s ease-out forwards;
    }
    .screen.visible { display: flex; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ========== Lobby Styles ========== */
    #lobby {
      gap: 25px;
      text-align: center;
      padding-top: 50px;
    }
    #lobby h2 {
      font-size: 2.5rem;
      color: var(--accent-color);
      margin-bottom: 15px;
      text-shadow: 0 0 8px var(--accent-color);
    }
    #lobby p {
      font-size: 1.1rem;
      margin-bottom: 20px;
    }
    #lobby button {
      background: var(--button-primary);
      width: 250px;
    }
    #lobby button:hover { background: #0056b3; transform: translateY(-3px); box-shadow: 0 8px 15px var(--shadow-dark); }

    /* ========== Common Button Styles ========== */
    button {
      padding: 12px 25px;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      font-weight: bold;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 8px var(--shadow-dark);
    }
    button:hover {
      opacity: 0.9;
      transform: scale(1.02);
      box-shadow: 0 6px 12px var(--shadow-dark);
    }
    button:active {
      transform: scale(0.98);
      box-shadow: 0 2px 4px var(--shadow-dark);
    }

    /* ========== Back Button (Common for Game Screens) ========== */
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: var(--button-warning);
      color: #000;
      font-size: 0.95rem;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1100;
      box-shadow: 0 2px 5px var(--shadow-dark);
    }
    .back-btn:hover { background: #e0a800; transform: scale(1.05); }

    /* ========== Input Field Styles ========== */
    input[type="number"] {
      padding: 10px 15px;
      font-size: 1rem;
      border: 1px solid var(--accent-color);
      border-radius: 5px;
      background: rgba(255,255,255,0.1);
      color: var(--text-color);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      margin: 0 10px;
      text-align: center;
      -moz-appearance: textfield; /* Remove number input arrows in Firefox */
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"]:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
    }

    /* ========== Casino Mines Styles ========== */
    #minesGame h2 { font-size: 2rem; margin-bottom: 20px; color: var(--accent-color); }
    #minesGame .info-panel { margin: 15px 0; font-size: 1.2rem; background: rgba(0,0,0,0.2); padding: 10px 20px; border-radius: 5px; }
    #minesGame .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin: 20px 0;
      max-width: 300px; /* Adjust grid size */
      width: 100%;
    }
    #minesGame .cell {
      width: 100%;
      padding-bottom: 100%; /* Makes cells square */
      position: relative;
      background: #444;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      transform: scale(0.98);
      opacity: 0.9;
      box-shadow: 0 2px 5px var(--shadow-dark);
    }
    #minesGame .cell:hover { filter: brightness(1.2); transform: scale(1); box-shadow: 0 4px 8px var(--shadow-dark); }
    #minesGame .cell.revealed {
      background: #88c; /* Safe cell color */
      animation: revealPop 0.3s forwards;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    }
    @keyframes revealPop {
      0% { transform: scale(0.95); opacity: 0.9; }
      70% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    #minesGame .cell.mine {
      background: #e00; /* Mine color */
      animation: bombExplosion 0.6s forwards;
      box-shadow: inset 0 0 10px var(--red-suit-color);
    }
    @keyframes bombExplosion {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    #minesGame #minesControls button {
      background: var(--button-primary);
    }
    #minesGame #startMinesBtn {
      background: var(--button-mines);
    }

    /* ========== Baccarat Styles ========== */
    #baccaratGame {
      align-items: center;
      justify-content: flex-start;
      padding-top: 40px;
      position: relative;
      gap: 15px;
    }
    #baccaratGame h2 {
      font-size: 2.2rem;
      margin-bottom: 20px;
      color: var(--accent-color);
    }
    #baccaratGame .bet-section {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }
    #baccaratGame .bet-section button {
      background: var(--button-baccarat);
    }
    #baccaratGame .options {
      display: flex;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    #baccaratGame .options button {
      background: var(--button-primary);
      color: var(--text-color);
      padding: 10px 20px;
      font-size: 0.95rem;
      border-radius: 6px;
    }
    #baccaratGame .options button.selected {
      background: var(--accent-color);
      color: #fff;
      box-shadow: 0 0 10px rgba(233, 69, 96, 0.7);
      transform: scale(1.05);
    }
    #baccaratGame .options button:hover {
      transform: scale(1.02);
    }
    #dealBtn {
      background: var(--button-mines);
      width: 200px;
      margin-top: 10px;
    }
    .hand-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
      width: 100%;
    }
    .hand-container > div {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .cards {
      display: flex;
      gap: 15px;
      margin-top: 5px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* ========== Card Flip Styles (Baccarat) ========== */
    .flip-container { perspective: 1000px; }
    .flip-card {
      width: 90px;
      height: 130px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* More bouncy transition */
      transform: rotateY(0deg);
      box-shadow: 0 5px 15px var(--shadow-dark);
      border-radius: 10px;
    }
    .flip-card.flip { transform: rotateY(180deg); }
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      font-weight: bold;
      padding: 5px;
      line-height: 1;
    }
    .card-back {
      background: linear-gradient(45deg, #444, #222);
      border: 3px solid var(--accent-color);
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
      background-image:
        radial-gradient(circle at 100% 150%, #444 24%, #333 25%, #333 28%, #444 29%, #444 36%, #333 36%, #333 40%, transparent 40%, transparent),
        radial-gradient(circle at 0% 150%, #444 24%, #333 25%, #333 28%, #444 29%, #444 36%, #333 36%, #333 40%, transparent 40%, transparent),
        radial-gradient(circle at 100% 50%, #444 5%, #333 6%, #333 9%, #444 10%, #444 17%, #333 17%, #333 20%, transparent 20%, transparent),
        radial-gradient(circle at 0% 50%, #444 5%, #333 6%, #333 9%, #444 10%, #444 17%, #333 17%, #333 20%, transparent 20%, transparent),
        radial-gradient(circle at 100% -50%, #444 24%, #333 25%, #333 28%, #444 29%, #444 36%, #333 36%, #333 40%, transparent 40%, transparent),
        radial-gradient(circle at 0% -50%, #444 24%, #333 25%, #333 28%, #444 29%, #444 36%, #333 36%, #333 40%, transparent 40%, transparent);
      background-size: 100px 50px;
      background-position: 0 0, 0 0, 0 0, 0 0, 0 0, 0 0;
      background-repeat: repeat-x;
      transform: rotateY(0deg);
    }
    .card-front {
      background: var(--card-front-color);
      color: #000;
      transform: rotateY(180deg);
      border: 2px solid #555;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
    }
    .card-front .rank { font-size: 1.8rem; font-weight: 700; }
    .card-front .suit { font-size: 1.2rem; }
    .red { color: var(--red-suit-color); }

    /* ========== Baccarat Result Animation ========== */
    .win-msg, .loss-msg {
      margin-top: 20px;
      font-size: 1.5rem;
      font-weight: bold;
      text-shadow: 2px 2px 5px var(--shadow-dark);
      padding: 10px 20px;
      border-radius: 8px;
      animation: resultHighlight 1.5s forwards cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .win-msg { color: #28a745; background: rgba(40,167,69,0.2); border: 1px solid #28a745; }
    .loss-msg { color: #dc3545; background: rgba(220,53,69,0.2); border: 1px solid #dc3545; }
    @keyframes resultHighlight {
      0% { opacity: 0; transform: scale(0.8) translateY(10px); }
      70% { opacity: 1; transform: scale(1.05) translateY(-5px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* ========== Baccarat Game History Panel ========== */
    #gameHistory {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 280px;
      max-height: 250px;
      background: rgba(0,0,0,0.7);
      padding: 15px;
      border-radius: 10px;
      overflow-y: auto;
      font-size: 0.9rem;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 0 15px var(--shadow-dark);
    }
    #gameHistory h3 {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--accent-color);
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-bottom: 5px;
    }
    .history-item {
      margin-bottom: 8px;
      padding: 5px 0;
      border-bottom: 1px dashed #444;
      line-height: 1.3;
    }
    .history-item:last-child { border-bottom: none; }
    .history-item.win { color: #28a745; }
    .history-item.loss { color: #dc3545; }
    .history-item.draw { color: #ffc107; }

    /* ========== Responsive Adjustments ========== */
    @media (max-width: 768px) {
      header { padding: 0 4%; height: 60px; }
      header h1 { font-size: 1.6rem; }
      .balance { font-size: 1.1rem; padding: 6px 12px; }
      .screen { top: 60px; min-height: calc(100% - 60px); padding: 20px 15px; }
      #lobby h2 { font-size: 2rem; }
      #lobby button, #dealBtn { width: 90%; max-width: 250px; font-size: 1rem; padding: 10px 20px; }
      .back-btn { top: 15px; left: 15px; padding: 8px 12px; font-size: 0.9rem; }
      #minesGame .grid { max-width: 280px; gap: 6px; }
      #minesGame .cell { border-radius: 5px; }
      .flip-card { width: 80px; height: 110px; border-radius: 8px; }
      .card-face { font-size: 1.4rem; padding: 5px; border-radius: 8px; }
      .card-front .rank { font-size: 1.5rem; }
      .card-front .suit { font-size: 1rem; }
      #baccaratGame .options button { padding: 8px 15px; font-size: 0.9rem; border-radius: 5px; }
      #gameHistory { width: 90%; max-width: 250px; bottom: 15px; left: 50%; transform: translateX(-50%); font-size: 0.85rem; padding: 12px; }
      .win-msg, .loss-msg { font-size: 1.3rem; padding: 8px 15px; }
      input[type="number"] { width: 70px; padding: 8px 12px; font-size: 0.9rem; }
    }

    @media (max-width: 480px) {
      header h1 { font-size: 1.4rem; letter-spacing: 1px; }
      .balance { font-size: 1rem; padding: 5px 10px; }
      .screen { padding: 15px 10px; }
      #lobby h2 { font-size: 1.8rem; }
      #lobby p { font-size: 1rem; }
      #lobby button { font-size: 0.95rem; padding: 10px 15px; }
      #minesGame .grid { max-width: 250px; gap: 5px; }
      #minesGame .cell { border-radius: 4px; }
      .flip-card { width: 65px; height: 95px; border-radius: 6px; }
      .card-face { font-size: 1.2rem; padding: 3px; border-radius: 6px; }
      .card-front .rank { font-size: 1.3rem; }
      .card-front .suit { font-size: 0.9rem; }
      #baccaratGame .bet-section { flex-direction: column; }
      #baccaratGame .bet-section input, #baccaratGame .bet-section button { margin: 5px 0; }
      #gameHistory { padding: 10px; font-size: 0.8rem; border-radius: 8px; }
      .win-msg, .loss-msg { font-size: 1.1rem; padding: 6px 12px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Gavin's Casino</h1>
    <div class="balance">Balance: â‚±<span id="globalBalance">10,000</span></div>
  </header>

  <div id="lobby" class="screen visible">
    <h2>Welcome to Gavin's Casino</h2>
    <p>Select a game to play</p>
    <button id="btnMines">Casino Mines</button>
    <button id="btnBaccarat">Baccarat</button>
  </div>

  <div id="minesGame" class="screen">
    <button class="back-btn" id="backFromMines">Back to Lobby</button>
    <h2>CASINO MINES</h2>
    <div id="betContainerMines">
      Bet Amount: â‚±<input type="number" id="betMines" value="100" min="1"/>
      <button id="startMinesBtn">Start Mines</button>
    </div>
    <div class="info-panel">
      Multiplier: x<span id="multiplierMines">1.00</span>
    </div>
    <div class="grid" id="minesGrid"></div>
    <div id="minesControls">
      <button id="cashoutMinesBtn">Cash Out</button>
    </div>
  </div>

  <div id="baccaratGame" class="screen">
    <button class="back-btn" id="backFromBaccarat">Back to Lobby</button>
    <h2>BACCARAT</h2>
    <div class="bet-section">
      <span>Bet Amount: â‚±</span><input type="number" id="betBaccarat" value="100" min="1"/>
      <button id="setBaccaratBetBtn">Set Bet</button>
    </div>
    <div class="options">
      <button id="betPlayerBtn" class="selected" data-bet="player">Player (1:1)</button>
      <button id="betBankerBtn" data-bet="banker">Banker (1:1)</button>
      <button id="betTieBtn" data-bet="tie">Tie (8:1)</button>
    </div>
    <button id="dealBtn">Deal Cards</button>
    <div class="hand-container">
      <div><strong>Player Hand:</strong> <span id="playerScoreDisplay"></span></div>
      <div class="cards" id="playerHand"></div>
    </div>
    <div class="hand-container">
      <div><strong>Banker Hand:</strong> <span id="bankerScoreDisplay"></span></div>
      <div class="cards" id="bankerHand"></div>
    </div>
    <div id="baccaratResult" class="result"></div>
    <div id="gameHistory">
      <h3>Game History</h3>
    </div>
  </div>

  <script>
    /* ================= Global State ================= */
    let globalBalance = 10000;
    updateGlobalBalance();
    function updateGlobalBalance() {
      document.getElementById('globalBalance').innerText = globalBalance.toLocaleString();
    }

    /* ================= Screen Switching Utility ================= */
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('visible');
      });
      document.getElementById(screenId).classList.add('visible');
    }

    /* ================= Lobby Button Handlers ================= */
    document.getElementById('btnMines').addEventListener('click', () => {
      showScreen('minesGame');
    });
    document.getElementById('btnBaccarat').addEventListener('click', () => {
      showScreen('baccaratGame');
      // Reset baccarat game state when entering the screen
      document.getElementById('playerHand').innerHTML = '';
      document.getElementById('bankerHand').innerHTML = '';
      document.getElementById('baccaratResult').innerText = '';
      document.getElementById('playerScoreDisplay').innerText = '';
      document.getElementById('bankerScoreDisplay').innerText = '';
    });
    document.getElementById('backFromMines').addEventListener('click', () => {
      showScreen('lobby');
      resetMinesGame(); // Reset Mines game when going back to lobby
    });
    document.getElementById('backFromBaccarat').addEventListener('click', () => {
      showScreen('lobby');
    });

    /* ================= Casino Mines Game Logic ================= */
    let minesBet = 100, minesMultiplier = 1.0, minesActive = false;
    const minesRows = 5, minesCols = 5, minesTotal = 5; // 5 mines for a 5x5 grid
    let minesData = [];
    const betMinesInput = document.getElementById('betMines');
    const multiplierMinesSpan = document.getElementById('multiplierMines');
    const minesGrid = document.getElementById('minesGrid');
    const cashoutMinesBtn = document.getElementById('cashoutMinesBtn');
    const startMinesBtn = document.getElementById('startMinesBtn');

    document.getElementById('startMinesBtn').addEventListener('click', initMinesGame);
    document.getElementById('cashoutMinesBtn').addEventListener('click', cashoutMines);
    betMinesInput.addEventListener('change', () => {
      if (parseInt(betMinesInput.value) < 1) betMinesInput.value = 1;
    });

    function initMinesGame() {
      if (minesActive) return; // Prevent starting a new game while one is active

      minesBet = parseInt(betMinesInput.value);
      if (isNaN(minesBet) || minesBet < 1) {
        alert("Please enter a valid bet amount (minimum â‚±1).");
        return;
      }
      if (minesBet > globalBalance) {
        alert("Bet exceeds your balance!");
        return;
      }

      globalBalance -= minesBet;
      updateGlobalBalance();
      minesMultiplier = 1.0;
      multiplierMinesSpan.innerText = minesMultiplier.toFixed(2);
      minesActive = true;
      minesData = [];
      cashoutMinesBtn.disabled = false;
      startMinesBtn.disabled = true;
      betMinesInput.disabled = true;

      // Initialize grid data
      for (let i = 0; i < minesRows; i++) {
        let row = [];
        for (let j = 0; j < minesCols; j++) {
          row.push({ mine: false, revealed: false });
        }
        minesData.push(row);
      }
      // Randomly place mines
      let placed = 0;
      while (placed < minesTotal) {
        let r = Math.floor(Math.random() * minesRows);
        let c = Math.floor(Math.random() * minesCols);
        if (!minesData[r][c].mine) {
          minesData[r][c].mine = true;
          placed++;
        }
      }
      renderMinesGrid();
    }

    function renderMinesGrid() {
      minesGrid.innerHTML = '';
      minesGrid.style.gridTemplateColumns = `repeat(${minesCols}, 1fr)`;
      for (let i = 0; i < minesRows; i++) {
        for (let j = 0; j < minesCols; j++) {
          const cellDiv = document.createElement('div');
          cellDiv.classList.add('cell');
          cellDiv.dataset.row = i;
          cellDiv.dataset.col = j;
          cellDiv.addEventListener('click', handleMinesCellClick);
          minesGrid.appendChild(cellDiv);
        }
      }
    }

    function handleMinesCellClick(e) {
      if (!minesActive) return;
      const cellDiv = e.currentTarget;
      const r = parseInt(cellDiv.dataset.row);
      const c = parseInt(cellDiv.dataset.col);
      const cell = minesData[r][c];

      if (cell.revealed) return; // Already clicked

      cell.revealed = true;
      if (cell.mine) {
        cellDiv.classList.add('mine');
        endMinesGame(false); // Player hit a mine
      } else {
        cellDiv.classList.add('revealed');
        minesMultiplier = parseFloat((minesMultiplier * 1.1).toFixed(2)); // Increase multiplier
        multiplierMinesSpan.innerText = minesMultiplier.toFixed(2);
        if (checkMinesWin()) {
          endMinesGame(true); // All safe cells revealed
        }
      }
    }

    function checkMinesWin() {
      let safeCells = minesRows * minesCols - minesTotal;
      let safeRevealed = 0;
      for (let i = 0; i < minesRows; i++) {
        for (let j = 0; j < minesCols; j++) {
          if (minesData[i][j].revealed && !minesData[i][j].mine) safeRevealed++;
        }
      }
      return safeRevealed === safeCells;
    }

    function endMinesGame(win) {
      minesActive = false;
      cashoutMinesBtn.disabled = true;
      startMinesBtn.disabled = false;
      betMinesInput.disabled = false;

      let resultMsg = "";
      let winAmount = 0;

      if (win) {
        winAmount = Math.floor(minesBet * minesMultiplier);
        globalBalance += winAmount;
        resultMsg = `Mines: You cleared all mines! You win â‚±${winAmount.toLocaleString()}!`;
      } else {
        resultMsg = `Mines: Boom! You hit a mine. You lost your bet.`;
      }

      alert(resultMsg);
      updateGlobalBalance();
      revealMinesGrid(); // Show all mines
    }

    function revealMinesGrid() {
      const cells = document.querySelectorAll('#minesGrid .cell');
      cells.forEach(cellDiv => {
        const r = parseInt(cellDiv.dataset.row);
        const c = parseInt(cellDiv.dataset.col);
        const cell = minesData[r][c];
        if (cell.mine) cellDiv.classList.add('mine');
        else if (!cell.revealed) cellDiv.classList.add('revealed');
      });
    }

    function cashoutMines() {
      if (!minesActive) return; // Can only cash out if game is active
      minesActive = false;
      cashoutMinesBtn.disabled = true;
      startMinesBtn.disabled = false;
      betMinesInput.disabled = false;

      const cash = Math.floor(minesBet * minesMultiplier);
      globalBalance += cash;
      alert(`Mines: Cashed out! You win â‚±${cash.toLocaleString()}`);
      updateGlobalBalance();
      revealMinesGrid(); // Show all mines after cash out
    }

    function resetMinesGame() {
      minesActive = false;
      minesMultiplier = 1.0;
      multiplierMinesSpan.innerText = minesMultiplier.toFixed(2);
      minesGrid.innerHTML = ''; // Clear grid
      cashoutMinesBtn.disabled = true;
      startMinesBtn.disabled = false;
      betMinesInput.disabled = false;
      betMinesInput.value = 100; // Reset bet input
    }


    /* ================= Baccarat Game Logic ================= */
    let baccaratDeck = [];
    let baccaratBetType = 'player'; // default bet type
    const playerScoreDisplay = document.getElementById('playerScoreDisplay');
    const bankerScoreDisplay = document.getElementById('bankerScoreDisplay');
    const gameHistoryDiv = document.getElementById('gameHistory');
    const betBaccaratInput = document.getElementById('betBaccarat');

    function createDeck() {
      const suits = ['â™ ','â™¥','â™¦','â™£'];
      const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const deck = [];
      for (let suit of suits) {
        for (let rank of ranks) {
          let value;
          if (rank === 'A') value = 1;
          else if (['J','Q','K','10'].includes(rank)) value = 0;
          else value = parseInt(rank);
          deck.push({ rank, suit, value });
        }
      }
      return deck;
    }

    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    document.getElementById('setBaccaratBetBtn').addEventListener('click', () => {
      // Just visually update the bet amount, actual deduction happens on deal
      let currentBet = parseInt(betBaccaratInput.value);
      if (isNaN(currentBet) || currentBet < 1) {
        alert("Please enter a valid bet amount (minimum â‚±1).");
        betBaccaratInput.value = 100; // Reset to default
      }
    });

    document.getElementById('betPlayerBtn').addEventListener('click', () => { baccaratBetType = 'player'; updateBetSelection(); });
    document.getElementById('betBankerBtn').addEventListener('click', () => { baccaratBetType = 'banker'; updateBetSelection(); });
    document.getElementById('betTieBtn').addEventListener('click', () => { baccaratBetType = 'tie'; updateBetSelection(); });

    function updateBetSelection() {
      document.querySelectorAll('#baccaratGame .options button').forEach(btn => {
        btn.classList.remove('selected');
      });
      document.querySelector(`#baccaratGame .options button[data-bet="${baccaratBetType}"]`).classList.add('selected');
    }
    updateBetSelection(); // Set initial selection on load

    document.getElementById('dealBtn').addEventListener('click', dealBaccarat);

    function getBaccaratScore(cards) {
      let score = cards.reduce((sum, card) => sum + card.value, 0);
      return score % 10;
    }

    // New function to handle third card rule
    function shouldDrawThirdCard(hand, isPlayerHand, bankerHand) {
      let score = getBaccaratScore(hand);

      if (isPlayerHand) { // Player's Third Card Rule
        if (score >= 0 && score <= 5) return true;
      } else { // Banker's Third Card Rule
        let playerScore = getBaccaratScore(bankerHand); // This is actually player's score before banker draws
        let bankerScore = score; // Banker's score with two cards

        if (bankerScore <= 2) return true;
        if (bankerScore === 3 && playerScore !== 8) return true;
        if (bankerScore === 4 && (playerScore >= 2 && playerScore <= 7)) return true;
        if (bankerScore === 5 && (playerScore >= 4 && playerScore <= 7)) return true;
        if (bankerScore === 6 && (playerScore >= 6 && playerScore <= 7)) return true;
      }
      return false;
    }


    async function dealBaccarat() {
      let betBaccarat = parseInt(betBaccaratInput.value);
      if (isNaN(betBaccarat) || betBaccarat < 1) {
        alert("Please enter a valid bet amount (minimum â‚±1).");
        return;
      }
      if (betBaccarat > globalBalance) {
        alert("Bet exceeds your balance!");
        return;
      }

      // Disable inputs/buttons during deal
      document.getElementById('dealBtn').disabled = true;
      document.getElementById('setBaccaratBetBtn').disabled = true;
      document.querySelectorAll('#baccaratGame .options button').forEach(btn => btn.disabled = true);
      betBaccaratInput.disabled = true;

      // Reset previous cards and result
      document.getElementById('playerHand').innerHTML = '';
      document.getElementById('bankerHand').innerHTML = '';
      document.getElementById('baccaratResult').innerText = '';
      document.getElementById('baccaratResult').className = "result"; // Reset classes
      playerScoreDisplay.innerText = '';
      bankerScoreDisplay.innerText = '';

      globalBalance -= betBaccarat;
      updateGlobalBalance();

      baccaratDeck = shuffle(createDeck());
      let playerCards = [];
      let bankerCards = [];

      // Deal initial 2 cards to Player
      playerCards.push(baccaratDeck.pop());
      playerCards.push(baccaratDeck.pop());
      displayFlippingCards('playerHand', playerCards);
      await new Promise(resolve => setTimeout(resolve, 1500)); // Delay for card flip

      // Deal initial 2 cards to Banker
      bankerCards.push(baccaratDeck.pop());
      bankerCards.push(baccaratDeck.pop());
      displayFlippingCards('bankerHand', bankerCards);
      await new Promise(resolve => setTimeout(resolve, 1500)); // Delay for card flip

      let playerScore = getBaccaratScore(playerCards);
      let bankerScore = getBaccaratScore(bankerCards);

      playerScoreDisplay.innerText = `Score: ${playerScore}`;
      bankerScoreDisplay.innerText = `Score: ${bankerScore}`;

      // Check for natural win
      if ((playerScore === 8 || playerScore === 9) || (bankerScore === 8 || bankerScore === 9)) {
        // No third cards drawn
      } else {
        // Player's third card rule
        if (shouldDrawThirdCard(playerCards, true)) {
          let thirdCard = baccaratDeck.pop();
          playerCards.push(thirdCard);
          await new Promise(resolve => setTimeout(() => {
            addFlippingCard('playerHand', thirdCard);
            playerScore = getBaccaratScore(playerCards);
            playerScoreDisplay.innerText = `Score: ${playerScore}`;
            resolve();
          }, 1000)); // Delay for third card flip
          await new Promise(resolve => setTimeout(resolve, 1500)); // Ensure flip animation finishes
        }

        // Banker's third card rule
        if (shouldDrawThirdCard(bankerCards, false, playerCards)) { // Pass player's final hand
          let thirdCard = baccaratDeck.pop();
          bankerCards.push(thirdCard);
          await new Promise(resolve => setTimeout(() => {
            addFlippingCard('bankerHand', thirdCard);
            bankerScore = getBaccaratScore(bankerCards);
            bankerScoreDisplay.innerText = `Score: ${bankerScore}`;
            resolve();
          }, 1000)); // Delay for third card flip
          await new Promise(resolve => setTimeout(resolve, 1500)); // Ensure flip animation finishes
        }
      }

      // Determine result and payout
      let resultText = "";
      let payout = 0;
      let historyClass = "";

      if (playerScore > bankerScore) {
        resultText = "Player wins!";
        if (baccaratBetType === 'player') { payout = betBaccarat * 2; historyClass = "win"; }
        else if (baccaratBetType === 'banker') { payout = 0; historyClass = "loss"; }
        else { payout = 0; historyClass = "loss"; } // Lost tie bet
      } else if (bankerScore > playerScore) {
        resultText = "Banker wins!";
        if (baccaratBetType === 'banker') { payout = betBaccarat * 2 * 0.95; historyClass = "win"; } // 5% commission on banker win
        else if (baccaratBetType === 'player') { payout = 0; historyClass = "loss"; }
        else { payout = 0; historyClass = "loss"; } // Lost tie bet
      } else { // It's a draw
        resultText = "It's a draw!";
        if (baccaratBetType === 'tie') { payout = betBaccarat * 9; historyClass = "win"; }
        else { payout = betBaccarat; historyClass = "draw"; } // Refund bet on draw if bet on player/banker
      }

      if (payout > 0) {
        globalBalance += Math.floor(payout); // Round down payout
        resultText += ` You win â‚±${Math.floor(payout).toLocaleString()}!`;
        document.getElementById('baccaratResult').className = "result win-msg";
      } else if (historyClass === "loss") {
        resultText += ` You lost your bet.`;
        document.getElementById('baccaratResult').className = "result loss-msg";
      } else { // Draw, bet refunded
         resultText += ` Your bet is returned.`;
         document.getElementById('baccaratResult').className = "result"; // No specific win/loss animation
      }

      document.getElementById('baccaratResult').innerText = resultText;
      updateGlobalBalance();
      addGameHistory(resultText, historyClass);

      // Re-enable buttons
      document.getElementById('dealBtn').disabled = false;
      document.getElementById('setBaccaratBetBtn').disabled = false;
      document.querySelectorAll('#baccaratGame .options button').forEach(btn => btn.disabled = false);
      betBaccaratInput.disabled = false;
    }

    function displayFlippingCards(containerId, cards) {
      const container = document.getElementById(containerId);
      container.innerHTML = ''; // Clear previous cards
      cards.forEach((card, index) => {
        const flipContainer = document.createElement('div');
        flipContainer.classList.add('flip-container');
        const flipCard = document.createElement('div');
        flipCard.classList.add('flip-card');
        flipCard.style.transitionDelay = (index * 0.2) + 's'; // Staggered initial deal
        const cardBack = document.createElement('div');
        cardBack.classList.add('card-face', 'card-back');
        const cardFront = document.createElement('div');
        cardFront.classList.add('card-face', 'card-front');
        cardFront.innerHTML = `<span class="rank">${card.rank}</span><span class="suit">${card.suit}</span>`;
        if (card.suit === 'â™¥' || card.suit === 'â™¦') {
          cardFront.classList.add('red');
        }
        flipCard.appendChild(cardBack);
        flipCard.appendChild(cardFront);
        flipContainer.appendChild(flipCard);
        container.appendChild(flipContainer);
        // Trigger flip after a short delay
        setTimeout(() => {
          flipCard.classList.add('flip');
        }, 100 + index * 300); // Staggered flip animation
      });
    }

    function addFlippingCard(containerId, card) {
      const container = document.getElementById(containerId);
      const flipContainer = document.createElement('div');
      flipContainer.classList.add('flip-container');
      const flipCard = document.createElement('div');
      flipCard.classList.add('flip-card');
      const cardBack = document.createElement('div');
      cardBack.classList.add('card-face', 'card-back');
      const cardFront = document.createElement('div');
      cardFront.classList.add('card-face', 'card-front');
      cardFront.innerHTML = `<span class="rank">${card.rank}</span><span class="suit">${card.suit}</span>`;
      if (card.suit === 'â™¥' || card.suit === 'â™¦') {
        cardFront.classList.add('red');
      }
      flipCard.appendChild(cardBack);
      flipCard.appendChild(cardFront);
      flipContainer.appendChild(flipCard);
      container.appendChild(flipContainer);
      // Trigger flip
      setTimeout(() => {
        flipCard.classList.add('flip');
      }, 100);
    }

    function addGameHistory(text, resultClass) {
      const newHistoryItem = document.createElement('div');
      newHistoryItem.className = `history-item ${resultClass}`;
      newHistoryItem.innerText = text;
      gameHistoryDiv.prepend(newHistoryItem);

      // Keep history to a reasonable length (e.g., last 10 items)
      while (gameHistoryDiv.children.length > 11) { // 1 for header + 10 items
        gameHistoryDiv.removeChild(gameHistoryDiv.lastChild);
      }
    }
  </script>
</body>
</html>
